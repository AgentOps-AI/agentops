<div id="a2e266428cefc683" class="cell markdown" data-collapsed="false">
<h1 id="multi-agent-support">Multi-Agent Support</h1>
<p>This is an example implementation of tracking events from two
separate agents</p>
</div>
<div id="7c566fac57d3b6ce" class="cell code" data-collapsed="false">
<div class="sourceCode" id="cb1"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> agentops</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> agentops.agent <span class="im">import</span> track_agent</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> dotenv <span class="im">import</span> load_dotenv</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> openai <span class="im">import</span> OpenAI</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> logging</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> IPython.display <span class="im">import</span> display, Markdown</span></code></pre></div>
</div>
<div id="9f8c52496c04693" class="cell code" data-collapsed="false">
<div class="sourceCode" id="cb2"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>load_dotenv()</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>OPENAI_API_KEY <span class="op">=</span> os.getenv(<span class="st">&quot;OPENAI_API_KEY&quot;</span>, <span class="st">&quot;&lt;your_openai_key&gt;&quot;</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>AGENTOPS_API_KEY <span class="op">=</span> os.getenv(<span class="st">&quot;AGENTOPS_API_KEY&quot;</span>, <span class="st">&quot;&lt;your_agentops_key&gt;&quot;</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>logging.basicConfig(</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    level<span class="op">=</span>logging.DEBUG</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>)  <span class="co"># this will let us see that calls are assigned to an agent</span></span></code></pre></div>
</div>
<div id="af062552554d60ce" class="cell code" data-collapsed="false">
<div class="sourceCode" id="cb3"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>agentops.init(AGENTOPS_API_KEY, tags<span class="op">=</span>[<span class="st">&quot;multi-agent-notebook&quot;</span>])</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>openai_client <span class="op">=</span> OpenAI(api_key<span class="op">=</span>OPENAI_API_KEY)</span></code></pre></div>
</div>
<div id="95d212546aaf1f82" class="cell markdown" data-collapsed="false">
<p>Now lets create a few agents!</p>
</div>
<div id="727e3cc26ce3ec3" class="cell code" data-collapsed="false">
<div class="sourceCode" id="cb4"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="at">@track_agent</span>(name<span class="op">=</span><span class="st">&quot;qa&quot;</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> QaAgent:</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> completion(<span class="va">self</span>, prompt: <span class="bu">str</span>):</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>        res <span class="op">=</span> openai_client.chat.completions.create(</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>            model<span class="op">=</span><span class="st">&quot;gpt-3.5-turbo&quot;</span>,</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>            messages<span class="op">=</span>[</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>                {</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&quot;role&quot;</span>: <span class="st">&quot;system&quot;</span>,</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&quot;content&quot;</span>: <span class="st">&quot;You are a qa engineer and only output python code, no markdown tags.&quot;</span>,</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>                },</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>                {<span class="st">&quot;role&quot;</span>: <span class="st">&quot;user&quot;</span>, <span class="st">&quot;content&quot;</span>: prompt},</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>            ],</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>            temperature<span class="op">=</span><span class="fl">0.5</span>,</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> res.choices[<span class="dv">0</span>].message.content</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a><span class="at">@track_agent</span>(name<span class="op">=</span><span class="st">&quot;engineer&quot;</span>)</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> EngineerAgent:</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> completion(<span class="va">self</span>, prompt: <span class="bu">str</span>):</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>        res <span class="op">=</span> openai_client.chat.completions.create(</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>            model<span class="op">=</span><span class="st">&quot;gpt-3.5-turbo&quot;</span>,</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>            messages<span class="op">=</span>[</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>                {</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&quot;role&quot;</span>: <span class="st">&quot;system&quot;</span>,</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&quot;content&quot;</span>: <span class="st">&quot;You are a software engineer and only output python code, no markdown tags.&quot;</span>,</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>                },</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>                {<span class="st">&quot;role&quot;</span>: <span class="st">&quot;user&quot;</span>, <span class="st">&quot;content&quot;</span>: prompt},</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>            ],</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>            temperature<span class="op">=</span><span class="fl">0.5</span>,</span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> res.choices[<span class="dv">0</span>].message.content</span></code></pre></div>
</div>
<div id="79b75d65de738522" class="cell code" data-collapsed="false">
<div class="sourceCode" id="cb5"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>qa <span class="op">=</span> QaAgent()</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>engineer <span class="op">=</span> EngineerAgent()</span></code></pre></div>
</div>
<div id="69dd3af9206308cc" class="cell markdown" data-collapsed="false">
<p>Now we have our agents and we tagged them with the
<code>@track_agent</code> decorator. Any LLM calls that go through this
class will now be tagged as agent calls in AgentOps.</p>
<p>Lets use these agents!</p>
</div>
<div id="830b86dac47dceb3" class="cell code" data-collapsed="false">
<div class="sourceCode" id="cb6"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>display(Markdown(<span class="st">&quot;```python</span><span class="ch">\n</span><span class="st">&quot;</span> <span class="op">+</span> generated_func <span class="op">+</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">```&quot;</span>))</span></code></pre></div>
</div>
<div id="63c9d0d457aee91a" class="cell code" data-collapsed="false">
<div class="sourceCode" id="cb7"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>generated_test <span class="op">=</span> qa.completion(</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Write a python unit test that test the following function: </span><span class="ch">\n</span><span class="st"> &quot;</span> <span class="op">+</span> generated_func</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
</div>
<div id="a88ffcbd2015d422" class="cell code" data-collapsed="false">
<div class="sourceCode" id="cb8"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>display(Markdown(<span class="st">&quot;```python</span><span class="ch">\n</span><span class="st">&quot;</span> <span class="op">+</span> generated_test <span class="op">+</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">```&quot;</span>))</span></code></pre></div>
</div>
<div id="1bd312ed049a5511" class="cell markdown" data-collapsed="false">
<p>Perfect! It generated the code as expected, and in the DEBUG logs,
you can see that the calls were made by agents named "engineer" and
"qa"!</p>
</div>
<div id="cbd0817a31756397" class="cell markdown" data-collapsed="false">
<p>Lets verify one more thing! If we make an LLM call outside of the
context of a tracked agent, we want to make sure it gets assigned to the
Default Agent.</p>
</div>
<div id="122e923cb07fd5f4" class="cell code" data-collapsed="false">
<div class="sourceCode" id="cb9"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>res <span class="op">=</span> openai_client.chat.completions.create(</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    model<span class="op">=</span><span class="st">&quot;gpt-3.5-turbo&quot;</span>,</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    messages<span class="op">=</span>[</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>        {<span class="st">&quot;role&quot;</span>: <span class="st">&quot;system&quot;</span>, <span class="st">&quot;content&quot;</span>: <span class="st">&quot;You are not a tracked agent&quot;</span>},</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>        {<span class="st">&quot;role&quot;</span>: <span class="st">&quot;user&quot;</span>, <span class="st">&quot;content&quot;</span>: <span class="st">&quot;Say hello&quot;</span>},</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>res.choices[<span class="dv">0</span>].message.content</span></code></pre></div>
</div>
<div id="a30909020c6a1ada" class="cell markdown" data-collapsed="false">
<p>You'll notice that we didn't log an agent name, so the AgentOps
backend will assign it to the Default Agent for the session!</p>
</div>
