---
title: Traces
description: Detailed breakdown of initializing AgentOps and managing traces.
---

A **Trace** encapsulates a singular execution instance of your workflow, bringing together all agents, LLMs, 
actions, etc., under one umbrella. Consequently, it is imperative for each event to be associated with a trace. 
The AgentOps dashboard provides detailed insights at the trace level, including costs, token counts, errors, and more.

**There must be an active trace in order to use AgentOps.**

---

## `Trace`

### Properties

Traces possess the following attributes:
- **ID**: A unique identifier for the trace.
- **Project ID**: Identifies the project associated with the trace, determined by the API Key used.
- **Starting Timestamp**: Marks the beginning of the trace.
- **Ending Timestamp**: Indicates when the trace concludes.
- **End State**: Signifies the success or failure of the trace.

Optionally, traces may include:
- **End State Reason**: Explains why the trace ended, whether due to an error or a user-triggered interrupt (SIGINT).
- **Tags**: Tags allow for the categorization and later retrieval of traces.
- **Host Environment**: Automatically gathers basic information about the system on which the trace ran.
- **Video**: If applicable, an optional video recording of the trace.

### Methods
#### `end_trace`
**Params**
- **end_state** (str, enum): Success|Failure|Indeterminate
- **end_state_reason** (optional, str): additional notes on end state

**Returns** (str): Total cost of trace in USD

#### `record`
**Params**
- **event** ([Event](/v1/concepts/events#event-class)): The Event to record as part of the trace


#### `add_tags`
**Params**
- **tags** (List[str]): a list of tags to assign to append to the current tags

#### `set_tags`
**Params**
- **tags** (List[str]): a list of tags to assign to append to set

_Note: Overrides any current tags_

#### `get_analytics`
**Returns** (dict): A dictionary containing various analytics metrics for the session.


## Starting a Trace
When you call `agentops.init()`, a trace is automatically started.
Calling `agentops.init(auto_start_trace=False)` will initialize the AgentOps SDK but not start a trace.

To start a trace later, call `agentops.start_trace()` [(reference)](/v1/usage/sdk-reference/#start-trace)

Both `agentops.init()` and `agentops.start_trace()` work as a factory pattern and return a `Trace` object. The above methods can all be called on this trace object.

## Ending a Trace
If a process ends without any call to agentops, it will show in the dashboard as `Indeterminate`.
To end with a state, call either `agentops.end_trace(...)` [(reference)](/v1/usage/sdk-reference/#end-trace) if only one trace is in use. Otherwise use `trace.end_trace(...)`.

## Inherited Traces
When working with multiple agents running in different processes, it's possible to initialize AgentOps or start a trace
with an existing trace_id.

`agentops.init(inherited_trace_id=<id>)`
`agentops.start_trace(inherited_trace_id=<id>)`

You can retrieve the current `trace_id` by assigning the returned value from `init()` or `start_trace()`.

<CodeGroup>

```python
import agentops
trace = agentops.init()
# pass trace.trace_id to the other process
```

```python
# -- other process --
trace_id = retrieve_trace_id() # <-- your function
agentops.init(inherited_trace_id=<id>)
```

</CodeGroup>

Both processes will now contribute data to the same trace.

## Trace Data Export
AgentOps provides REST endpoints to export your trace data and statistics. These endpoints allow you to retrieve detailed information about your traces programmatically.

### Authentication
All data export requests require a single header:
- `X-Agentops-Api-Key`: Your AgentOps API key

### Available Endpoints

#### Get Trace Statistics
```http
GET /v2/traces/<trace_id>/stats
```

Returns statistics for the specified trace including:
- Event counts
- Duration
- Costs
- Token usage
- Other trace metrics

#### Export Complete Trace Data
```http
GET /v2/traces/<trace_id>/export
```

Returns comprehensive trace data including:
- Trace metadata
- Statistics
- All recorded events:
  - Actions
  - LLM calls
  - Tool usage
  - Errors

### Example Usage
```python
import requests

# Your AgentOps API key
api_key = "your-api-key"
trace_id = "your-trace-id"

headers = {
    "X-Agentops-Api-Key": api_key
}

# Get trace stats
stats_url = f"https://api.agentops.ai/v2/traces/{trace_id}/stats"
stats_response = requests.get(stats_url, headers=headers)
stats = stats_response.json()

# Export complete trace data
export_url = f"https://api.agentops.ai/v2/traces/{trace_id}/export"
export_response = requests.get(export_url, headers=headers)
trace_data = export_response.json()
```

## Trace Analytics
You can retrieve the analytics for a trace by calling `trace.get_analytics()`.

The example below shows how to record events and retrieve analytics.

<CodeGroup>

```python
import agentops
trace = agentops.init()
trace.record(ActionEvent("llms"))
trace.record(ActionEvent("tools"))
analytics = trace.get_analytics()
print(analytics)
trace.end_trace("Success")
```

The output will look like this -

```bash
{'LLM calls': 0, 'Tool calls': 0, 'Actions': 0, 'Errors': 0, 'Duration': '0.9s', 'Cost': '0.00'}
```

</CodeGroup>

## The AgentOps SDK Client
_More info for the curious_

Under the hood, `agentops.init()` creates a `Client` object with various configuration options. Whenever you start a new trace, these configuration options will automatically
be applied. You can also apply different configuration options when you start a new trace by passing in a
[Configuration](/v1/usage/sdk-reference/#configuration) object.

<script type="module" src="/scripts/github_stars.js"></script>
<script type="module" src="/scripts/adjust_api_dynamically.js"></script>
